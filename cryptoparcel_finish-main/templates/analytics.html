{% extends 'base.html' %}
{% block title %}Analytics — CryptoParcel{% endblock %}
{% block content %}
<section class="section">
  <div class="page-header">
    <div>
      <h1>Analytics</h1>
      <p class="muted">High-level view of your labels and spend, updated from your recent activity.</p>
    </div>
    <div class="page-meta">
      <div class="meta-item">
        <span class="meta-label">Total labels</span>
        <span class="meta-value">{{ total_orders }}</span>
      </div>
      <div class="meta-item">
        <span class="meta-label">Total spent</span>
        <span class="meta-value">${{ '%.2f'|format(total_spent) }}</span>
      </div>
    </div>
  </div>

  <div class="grid-2 analytics-grid">
    <div class="card">
      <h3>Labels per day</h3>
      {% if daily_labels %}
        <div class="analytics-bars">
          {% set max_count = (daily_labels | map(attribute=1) | max) %}
          {% for day, count in daily_labels %}
            <div class="analytics-bar-row">
              <div class="analytics-bar-label">{{ day }}</div>
              <div class="analytics-bar-track">
                <div class="analytics-bar-fill" style="width: {{ (100 * count / max_count)|round(0) }}%;"></div>
              </div>
              <div class="analytics-bar-value">{{ count }}</div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="muted">No labels yet — once you start creating labels, you'll see your volume over time here.</p>
      {% endif %}
    </div>

    <div class="card">
      <h3>Spend per day (USD)</h3>
      {% if daily_spent %}
        <div class="analytics-bars">
          {% set max_amt = (daily_spent | map(attribute=1) | max) %}
          {% for day, amt in daily_spent %}
            <div class="analytics-bar-row">
              <div class="analytics-bar-label">{{ day }}</div>
              <div class="analytics-bar-track">
                <div class="analytics-bar-fill" style="width: {{ (100 * amt / max_amt)|round(0) }}%;"></div>
              </div>
              <div class="analytics-bar-value">${{ '%.2f'|format(amt) }}</div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="muted">No spend yet. Once you start paying for labels, you'll see daily totals here.</p>
      {% endif %}
    </div>
  </div>
</section>

<section class="section">
  <div class="grid-2 analytics-grid">
    <div class="card">
      <h3>Labels by carrier</h3>
      {% if by_carrier %}
        <table class="table">
          <thead>
            <tr>
              <th>Carrier</th>
              <th>Label count</th>
            </tr>
          </thead>
          <tbody>
            {% for carrier, count in by_carrier.items() %}
              <tr>
                <td>{{ carrier }}</td>
                <td>{{ count }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="muted">No carrier data yet.</p>
      {% endif %}
    </div>

    <div class="card">
      <h3>Labels by service</h3>
      {% if by_service %}
        <table class="table">
          <thead>
            <tr>
              <th>Service</th>
              <th>Label count</th>
            </tr>
          </thead>
          <tbody>
            {% for service, count in by_service.items() %}
              <tr>
                <td>{{ service }}</td>
                <td>{{ count }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="muted">No service breakdown yet.</p>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
