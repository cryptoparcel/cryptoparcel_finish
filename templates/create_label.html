<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Shipping Label â€¢ CryptoParcel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body class="cp-body">
<header class="cp-header">
    <div class="cp-container cp-header-inner">
        <a href="{{ url_for('index') }}" class="cp-logo">
            <span class="cp-logo-icon">ðŸ“¦</span>
            <span class="cp-logo-text">CryptoParcel</span>
        </a>
        <nav class="cp-nav">
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
            <a href="{{ url_for('wallet') }}">Wallet</a>
            <a href="{{ url_for('orders') }}">Orders</a>
            <a href="{{ url_for('create_label') }}" class="cp-nav-cta">Create Label</a>
        </nav>
    </div>
</header>

<main class="cp-main">
    <div class="cp-container">
        <div class="cp-page-heading">
            <h1>Create Shipping Label</h1>
            <p>Fill out the details below, choose your payment method, and generate a label in minutes.</p>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="cp-flash-stack">
            {% for category, message in messages %}
            <div class="cp-flash cp-flash-{{ category }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <div class="cp-layout-grid">
            <!-- Left: Form -->
            <section class="cp-card cp-card-large">
                <form method="POST" action="{{ url_for('create_label') }}" class="cp-form">
                    {{ csrf_token() if csrf_token is defined else "" }}

                    <div class="cp-section">
                        <h2 class="cp-section-title">From Address</h2>
                        <div class="cp-grid-2">
                            <div class="cp-field">
                                <label for="from_name">Name</label>
                                <input type="text" id="from_name" name="from_name" placeholder="Sender name" required>
                            </div>
                            <div class="cp-field">
                                <label for="from_street1">Street</label>
                                <input type="text" id="from_street1" name="from_street1" placeholder="123 Main St" required>
                            </div>
                        </div>
                        <div class="cp-grid-3">
                            <div class="cp-field">
                                <label for="from_city">City</label>
                                <input type="text" id="from_city" name="from_city" placeholder="Los Angeles" required>
                            </div>
                            <div class="cp-field">
                                <label for="from_state">State</label>
                                <input type="text" id="from_state" name="from_state" maxlength="2" placeholder="CA" required>
                            </div>
                            <div class="cp-field">
                                <label for="from_zip">ZIP</label>
                                <input type="text" id="from_zip" name="from_zip" maxlength="10" placeholder="90001" required>
                            </div>
                        </div>
                    </div>

                    <div class="cp-section">
                        <h2 class="cp-section-title">To Address</h2>
                        <div class="cp-grid-2">
                            <div class="cp-field">
                                <label for="to_name">Name</label>
                                <input type="text" id="to_name" name="to_name" placeholder="Recipient name" required>
                            </div>
                            <div class="cp-field">
                                <label for="to_street1">Street</label>
                                <input type="text" id="to_street1" name="to_street1" placeholder="456 Oak Ave" required>
                            </div>
                        </div>
                        <div class="cp-grid-3">
                            <div class="cp-field">
                                <label for="to_city">City</label>
                                <input type="text" id="to_city" name="to_city" placeholder="New York" required>
                            </div>
                            <div class="cp-field">
                                <label for="to_state">State</label>
                                <input type="text" id="to_state" name="to_state" maxlength="2" placeholder="NY" required>
                            </div>
                            <div class="cp-field">
                                <label for="to_zip">ZIP</label>
                                <input type="text" id="to_zip" name="to_zip" maxlength="10" placeholder="10001" required>
                            </div>
                        </div>
                    </div>

                    <div class="cp-section cp-section-split">
                        <div class="cp-field">
                            <label for="service">Carrier &amp; Service</label>
                            <select id="service" name="service" required>
                                <optgroup label="USPS">
                                    <option value="USPS First-Class">USPS First-Class (3â€“5 days)</option>
                                    <option value="USPS Priority Mail">USPS Priority Mail (2â€“3 days)</option>
                                    <option value="USPS Priority Mail Express">USPS Priority Mail Express (Overnight)</option>
                                </optgroup>
                                <optgroup label="UPS">
                                    <option value="UPS Ground">UPS Ground (1â€“5 days)</option>
                                    <option value="UPS 2nd Day Air">UPS 2nd Day Air</option>
                                    <option value="UPS Next Day Air Saver">UPS Next Day Air Saver</option>
                                </optgroup>
                                <optgroup label="FedEx">
                                    <option value="FedEx Ground">FedEx Ground (1â€“5 days)</option>
                                    <option value="FedEx 2Day">FedEx 2Day</option>
                                    <option value="FedEx Standard Overnight">FedEx Standard Overnight</option>
                                </optgroup>
                            </select>
                            <p class="cp-field-hint">These are simple presets. Final rates are based on weight only in this version.</p>
                        </div>

                        <div class="cp-grid-2">
                            <div class="cp-field">
                                <label for="weight_oz">Weight (oz)</label>
                                <input type="number" step="0.1" min="0.1" id="weight_oz" name="weight_oz" placeholder="e.g. 12.5" required>
                            </div>
                            <div class="cp-field">
                                <label for="reference">Reference (optional)</label>
                                <input type="text" id="reference" name="reference" placeholder="Order #, notes, etc.">
                            </div>
                        </div>
                    </div>

                    <div class="cp-section">
                        <h2 class="cp-section-title">Payment</h2>
                        <div class="cp-grid-2 cp-align-center">
                            <div class="cp-field">
                                <label for="payment_method">Pay With</label>
                                <select id="payment_method" name="payment_method" required>
                                    <option value="wallet" {% if preferred_method == 'wallet' %}selected{% endif %}>
                                        Wallet Balance ({{ '%.2f'|format(balance or 0.0) }} USD)
                                    </option>
                                    <option value="crypto" {% if preferred_method == 'crypto' %}selected{% endif %}>
                                        Crypto via NOWPayments
                                    </option>
                                </select>
                            </div>
                            <div class="cp-payment-info">
                                <p>Estimated label price is calculated from carrier, service, and weight.</p>
                                <p class="cp-payment-note">
                                    If wallet balance is insufficient, the app will automatically fall back to crypto checkout.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="cp-form-actions">
                        <a href="{{ url_for('dashboard') }}" class="cp-btn cp-btn-secondary">Cancel</a>
                        <button type="submit" class="cp-btn cp-btn-primary">
                            Generate Label
                        </button>
                    </div>
                </form>
            </section>

            <!-- Right: Summary / Tips -->
            <aside class="cp-card cp-card-side">
                <h2 class="cp-section-title">How it works</h2>
                <ol class="cp-steps">
                    <li>Enter from &amp; to addresses along with package weight.</li>
                    <li>Pick a carrier/service that matches your speed &amp; budget.</li>
                    <li>Choose to pay from your wallet balance or in crypto.</li>
                    <li>Once paid, you can download a ready-to-print PDF label.</li>
                </ol>

                <div class="cp-card-highlight">
                    <h3>Wallet Tips</h3>
                    <ul>
                        <li>Top up with crypto on the <a href="{{ url_for('wallet') }}">Wallet</a> page.</li>
                        <li>Wallet payments are instantâ€”no extra checkout step.</li>
                        <li>Every label purchase is logged in your wallet history.</li>
                    </ul>
                </div>

                <div class="cp-card-highlight cp-card-subtle">
                    <h3>Need help?</h3>
                    <p>
                        If a payment looks stuck, refresh your wallet or order page.
                        Most issues auto-resolve within a few minutes.
                    </p>
                </div>
            </aside>
        </div>
    </div>
</main>

<footer class="cp-footer">
    <div class="cp-container cp-footer-inner">
        <span>Â© CryptoParcel</span>
        <span class="cp-footer-right">Ship smarter with crypto.</span>
    </div>
</footer>
</body>
</html>
