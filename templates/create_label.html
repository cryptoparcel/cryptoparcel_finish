{% extends "base.html" %}
{% block title %}Create Label - CryptoParcel{% endblock %}
{% block content %}
<section class="cp-inner">
  <div class="container">
    <h1 style="text-align: center; margin: 0 0 32px;">Create a Shipping Label</h1>

    <form method="POST" class="cp-form-card">
      <!-- Shipped To -->
      <h2 style="margin: 0 0 12px;">Shipped To</h2>
      <div class="cp-field-group">
        <label>Name</label>
        <input type="text" name="to_name" required placeholder="Jane Smith">
      </div>
      <div class="cp-field-group">
        <label>Street Address</label>
        <input type="text" name="to_address" required placeholder="456 Oak Avenue">
      </div>
      <div class="cp-field-group">
        <label>Apt/Suite (optional)</label>
        <input type="text" name="to_street2" placeholder="Apt 4B">
      </div>
      <div class="cp-field-grid">
        <div class="cp-field-group">
          <label>City</label>
          <input type="text" name="to_city" required>
        </div>
        <div class="cp-field-group">
          <label>State</label>
          <select name="to_state" required>
            <option value="">Select state</option>
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
          </select>
        </div>
        <div class="cp-field-group">
          <label>ZIP</label>
          <input type="text" name="to_zip" required placeholder="10001">
        </div>
      </div>

      <!-- Shipped From -->
      <h2 style="margin: 32px 0 12px;">Shipped From</h2>
      <div class="cp-field-group">
        <label>Name</label>
        <input type="text" name="from_name" required placeholder="John Doe">
      </div>
      <div class="cp-field-group">
        <label>Street Address</label>
        <input type="text" name="from_address" required placeholder="123 Main Street">
      </div>
      <div class="cp-field-group">
        <label>Apt/Suite (optional)</label>
        <input type="text" name="from_street2" placeholder="Suite 200">
      </div>
      <div class="cp-field-grid">
        <div class="cp-field-group">
          <label>City</label>
          <input type="text" name="from_city" required>
        </div>
        <div class="cp-field-group">
          <label>State</label>
          <select name="from_state" required>
            <option value="">Select state</option>
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
          </select>
        </div>
        <div class="cp-field-group">
          <label>ZIP</label>
          <input type="text" name="from_zip" required placeholder="90210">
        </div>
      </div>

      <!-- Package Details -->
      <h2 style="margin: 32px 0 12px;">Package Details</h2>
      <div class="cp-field-grid">
        <div class="cp-field-group">
          <label>Carrier</label>
          <select id="carrier">
            <option value="">Select carrier...</option>
            <option value="USPS">USPS</option>
            <option value="UPS">UPS</option>
            <option value="FedEx">FedEx</option>
          </select>
        </div>
        <div class="cp-field-group">
          <label>Package Type</label>
          <select id="package_type">
            <option value="your_box">Your Own Box</option>
            <option value="your_tube">Your Own Tube</option>
            <option value="usps_flat_rate">USPS Flat Rate</option>
            <option value="ups_box">UPS Box</option>
            <option value="fedex_box">FedEx Box</option>
          </select>
        </div>
      </div>

      <div class="cp-field-grid">
        <div class="cp-field-group">
          <label>Service</label>
          <select name="service" id="service" required>
            <option value="">Select carrier first...</option>
          </select>
        </div>
        <div class="cp-field-group">
          <label>Weight (oz)</label>
          <input type="number" step="0.1" id="weight_oz" required placeholder="16.0">
        </div>
      </div>

      <div class="cp-field-grid">
        <div class="cp-field-group">
          <label>Length (in)</label>
          <input type="number" step="0.1" id="length_in" placeholder="11.0">
        </div>
        <div class="cp-field-group">
          <label>Width (in)</label>
          <input type="number" step="0.1" id="width_in" placeholder="8.0">
        </div>
        <div class="cp-field-group">
          <label>Height (in)</label>
          <input type="number" step="0.1" id="height_in" placeholder="4.0">
        </div>
      </div>

      <!-- Live Summary -->
      <div style="margin: 32px 0; padding: 20px; background: var(--cp-surface-soft); border-radius: var(--cp-radius-card); text-align: center;">
        <h2 style="margin: 0 0 12px;">Estimated Label Price</h2>
        <p style="font-size: 1.8rem; margin: 0; color: var(--cp-accent);">
          <strong id="price-usd">$0.00</strong> USD
        </p>
        <p style="margin: 12px 0 0; color: var(--cp-text-muted);">
          ≈ <strong id="price-btc">—</strong> BTC
        </p>
      </div>

      <button type="submit" class="cp-btn-large" style="margin-top: 16px;">
        Continue to Payment
      </button>
    </form>
  </div>
</section>

<script>
  (function() {
    const carrier = document.getElementById('carrier');
    const service = document.getElementById('service');
    const weightOz = document.getElementById('weight_oz');
    const usd = document.getElementById('price-usd');
    const btc = document.getElementById('price-btc');

    const services = {
      USPS: ["Ground Advantage", "Priority Mail", "Priority Mail Express"],
      UPS: ["Ground", "2nd Day Air", "Next Day Air"],
      FedEx: ["Ground", "2Day", "Overnight"]
    };

    function updateServices() {
      const selected = carrier.value;
      service.innerHTML = '<option value="">Select service...</option>';
      if (services[selected]) {
        services[selected].forEach(s => {
          const opt = document.createElement('option');
          opt.value = s;
          opt.textContent = s;
          service.appendChild(opt);
        });
      }
    }

    function updatePrice() {
      const w = parseFloat(weightOz.value) || 0;
      const s = service.value || '';

      if (!s || w <= 0) {
        usd.textContent = '$0.00';
        btc.textContent = '—';
        return;
      }

      let base = 3.0;
      if (/express|overnight|priority|next day|2day/i.test(s)) base += 2.0;
      const priceUsd = Math.round((base + w * 0.10) * 100) / 100;

      usd.textContent = `$${priceUsd.toFixed(2)}`;
      const priceBtc = (priceUsd / 95000).toFixed(6);
      btc.textContent = `${priceBtc} BTC`;
    }

    carrier.addEventListener('change', updateServices);
    carrier.addEventListener('change', updatePrice);
    service.addEventListener('change', updatePrice);
    weightOz.addEventListener('input', updatePrice);

    // Initial
    updateServices();
    updatePrice();
  })();
</script>
{% endblock %}
