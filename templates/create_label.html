{% extends "base.html" %}
{% block title %}Create Label - CryptoParcel{% endblock %}
{% block content %}
<section class="cp-inner">
  <div class="container">
    <h1 style="text-align: center; margin: 0 0 32px;">Create a Shipping Label</h1>

    <form method="POST" class="cp-form-card">
      <!-- Shipped To -->
      <h2 style="margin: 0 0 12px;">Shipped To</h2>
      <div class="cp-field-group">
        <label>Name</label>
        <input type="text" name="to_name" required placeholder="Jane Smith">
      </div>
      <div class="cp-field-group">
        <label>Street Address</label>
        <input type="text" name="to_address" required placeholder="456 Oak Avenue">
      </div>
      <div class="cp-field-group">
        <label>Apt/Suite (optional)</label>
        <input type="text" name="to_street2" placeholder="Apt 4B">
      </div>
      <div class="cp-field-grid">
        <div class="cp-field-group">
          <label>City</label>
          <input type="text" name="to_city" required>
        </div>
        <div class="cp-field-group">
          <label>State</label>
          <select name="to_state" required>
            <option value="">State</option>
            <option value="AL">AL</option><option value="AK">AK</option><option value="AZ">AZ</option>
            <option value="AR">AR</option><option value="CA">CA</option><option value="CO">CO</option>
            <option value="CT">CT</option><option value="DE">DE</option><option value="FL">FL</option>
            <option value="GA">GA</option><option value="HI">HI</option><option value="ID">ID</option>
            <option value="IL">IL</option><option value="IN">IN</option><option value="IA">IA</option>
            <option value="KS">KS</option><option value="KY">KY</option><option value="LA">LA</option>
            <option value="ME">ME</option><option value="MD">MD</option><option value="MA">MA</option>
            <option value="MI">MI</option><option value="MN">MN</option><option value="MS">MS</option>
            <option value="MO">MO</option><option value="MT">MT</option><option value="NE">NE</option>
            <option value="NV">NV</option><option value="NH">NH</option><option value="NJ">NJ</option>
            <option value="NM">NM</option><option value="NY">NY</option><option value="NC">NC</option>
            <option value="ND">ND</option><option value="OH">OH</option><option value="OK">OK</option>
            <option value="OR">OR</option><option value="PA">PA</option><option value="RI">RI</option>
            <option value="SC">SC</option><option value="SD">SD</option><option value="TN">TN</option>
            <option value="TX">TX</option><option value="UT">UT</option><option value="VT">VT</option>
            <option value="VA">VA</option><option value="WA">WA</option><option value="WV">WV</option>
            <option value="WI">WI</option><option value="WY">WY</option>
          </select>
        </div>
        <div class="cp-field-group">
          <label>ZIP</label>
          <input type="text" name="to_zip" required placeholder="10001">
        </div>
      </div>

      <!-- Shipped From -->
      <h2 style="margin: 32px 0 12px;">Shipped From</h2>
      <div class="cp-field-group">
        <label>Name</label>
        <input type="text" name="from_name" required placeholder="John Doe">
      </div>
      <div class="cp-field-group">
        <label>Street Address</label>
        <input type="text" name="from_address" required placeholder="123 Main Street">
      </div>
      <div class="cp-field-group">
        <label>Apt/Suite (optional)</label>
        <input type="text" name="from_street2" placeholder="Suite 200">
      </div>
      <div class="cp-field-grid">
        <div class="cp-field-group">
          <label>City</label>
          <input type="text" name="from_city" required>
        </div>
        <div class="cp-field-group">
          <label>State</label>
          <select name="from_state" required>
            <option value="">State</option>
            <!-- Same state list -->
            <option value="WY">WY</option>
          </select>
        </div>
        <div class="cp-field-group">
          <label>ZIP</label>
          <input type="text" name="from_zip" required placeholder="90210">
        </div>
      </div>

      <!-- Package Details -->
      <h2 style="margin: 32px 0 12px;">Package Details</h2>
      <div class="cp-field-grid">
        <div class="cp-field-group">
          <label>Carrier</label>
          <select name="carrier" id="carrier">
            <option value="USPS">USPS</option>
            <option value="UPS">UPS</option>
            <option value="FedEx">FedEx</option>
          </select>
        </div>
        <div class="cp-field-group">
          <label>Package Type</label>
          <select id="package_type">
            <option value="your_box">Your Own Box</option>
            <option value="your_tube">Your Own Tube</option>
            <option value="usps_small_flat">USPS Small Flat Rate Box</option>
            <option value="usps_medium_flat">USPS Medium Flat Rate Box</option>
            <option value="usps_large_flat">USPS Large Flat Rate Box</option>
            <option value="usps_flat_envelope">USPS Flat Rate Envelope</option>
            <option value="ups_express_box">UPS Express Box</option>
            <option value="ups_express_tube">UPS Express Tube</option>
            <option value="fedex_box_small">FedEx Small Box</option>
            <option value="fedex_box_medium">FedEx Medium Box</option>
            <option value="fedex_envelope">FedEx Envelope</option>
            <option value="fedex_tube">FedEx Tube</option>
          </select>
        </div>
        <div class="cp-field-group">
          <label>Service</label>
          <select name="service" id="service">
            <option value="">Select...</option>
            <optgroup label="USPS">
              <option value="USPS Ground Advantage">Ground Advantage</option>
              <option value="USPS Priority Mail">Priority Mail</option>
              <option value="USPS Priority Mail Express">Priority Mail Express</option>
            </optgroup>
            <optgroup label="UPS">
              <option value="UPS Ground">Ground</option>
              <option value="UPS 2nd Day Air">2nd Day Air</option>
              <option value="UPS Next Day Air">Next Day Air</option>
            </optgroup>
            <optgroup label="FedEx">
              <option value="FedEx Ground">Ground</option>
              <option value="FedEx 2Day">2Day</option>
              <option value="FedEx Overnight">Overnight</option>
            </optgroup>
          </select>
        </div>
      </div>

      <div class="cp-field-grid">
        <div class="cp-field-group">
          <label>Weight (oz)</label>
          <input type="number" step="0.1" id="weight_oz" required placeholder="16.0">
        </div>
        <div class="cp-field-group">
          <label>Length (in)</label>
          <input type="number" step="0.1" id="length_in" placeholder="11.0">
        </div>
        <div class="cp-field-group">
          <label>Width (in)</label>
          <input type="number" step="0.1" id="width_in" placeholder="8.0">
        </div>
        <div class="cp-field-group">
          <label>Height (in)</label>
          <input type="number" step="0.1" id="height_in" placeholder="4.0">
        </div>
      </div>

      <!-- Calculate Button -->
      <button type="button" id="calc-btn" class="cp-btn-primary" style="margin: 24px 0;">
        Calculate Label Price
      </button>

      <!-- Summary (hidden until calculated) -->
      <div id="summary-box" style="display:none; padding: 20px; background: var(--cp-surface-soft); border-radius: var(--cp-radius-card); text-align: center;">
        <h2 style="margin: 0 0 12px;">Estimated Label Price</h2>
        <p style="font-size: 1.8rem; margin: 0; color: var(--cp-accent);">
          <strong id="price-usd">$0.00</strong> USD
        </p>
        <p style="margin: 12px 0 0; color: var(--cp-text-muted);">
          ≈ <strong id="price-btc">—</strong> BTC
        </p>
      </div>

      <button type="submit" class="cp-btn-large" id="submit-btn" style="margin-top: 24px;">
        Continue to Payment
      </button>
    </form>
  </div>
</section>

<script>
  (function() {
    const calcBtn = document.getElementById('calc-btn');
    const summary = document.getElementById('summary-box');
    const usdEl = document.getElementById('price-usd');
    const btcEl = document.getElementById('price-btc');
    const service = document.getElementById('service');
    const weightOz = document.getElementById('weight_oz');

    calcBtn.addEventListener('click', () => {
      const w = parseFloat(weightOz.value) || 0;
      const s = service.value || '';

      if (!s || w <= 0) {
        alert("Please select a service and enter weight");
        return;
      }

      let base = 3.0;
      if (/express|overnight|priority|next day|2day/i.test(s)) base += 2.0;
      const usd = Math.round((base + w * 0.10) * 100) / 100;

      usdEl.textContent = `$${usd.toFixed(2)}`;
      const btc = (usd / 95000).toFixed(6); // Approx BTC price
      btcEl.textContent = `${btc} BTC`;

      summary.style.display = 'block';
      summary.scrollIntoView({ behavior: 'smooth' });
    });
  })();
</script>
{% endblock %}
