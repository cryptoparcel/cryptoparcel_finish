<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>{% block title %}CryptoParcel{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
<div class="cp-page">

    <!-- Top nav -->
    <header class="cp-nav">
        <div class="cp-nav-left">
            <a href="{{ url_for('index') }}" class="cp-logo">
                <span class="cp-logo-icon">ðŸ“¦</span>
                <span class="cp-logo-text">CryptoParcel</span>
            </a>

            <nav class="cp-nav-links">
                <a href="{{ url_for('index') }}">Home</a>
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('dashboard') }}">Dashboard</a>
                    <a href="{{ url_for('orders') }}">Orders</a>
                    <a href="{{ url_for('wallet') }}">Wallet</a>
                {% endif %}
            </nav>
        </div>

        <div class="cp-nav-right">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('create_label') }}" class="cp-nav-primary">
                    Create label
                </a>

                <div class="cp-user-menu">
                    <button type="button" class="cp-user-trigger">
                        <div class="cp-user-avatar">
                            {{ (current_user.email or 'U')[:1] | upper }}
                        </div>
                        <div class="cp-user-meta">
                            <span class="cp-user-label">Signed in</span>
                            <span class="cp-user-email">
                                {{ current_user.email or 'Account' }}
                            </span>
                        </div>
                        <span class="cp-user-caret">â–¾</span>
                    </button>
                    <div class="cp-user-dropdown">
                        <a href="{{ url_for('dashboard') }}">Dashboard</a>
                        <a href="{{ url_for('orders') }}">Orders</a>
                        <a href="{{ url_for('wallet') }}">Wallet</a>
                        <a href="{{ url_for('api_keys') }}">API keys</a>
                        <a href="/settings">Settings</a>  <!-- placeholder settings link -->
                        <div class="cp-user-divider"></div>
                        <a href="{{ url_for('logout') }}">Sign out</a>
                    </div>
                </div>
            {% else %}
                <a href="{{ url_for('login') }}" class="cp-nav-ghost">
                    Log in
                </a>
                <a href="{{ url_for('register') }}" class="cp-nav-primary">
                    Sign up
                </a>
            {% endif %}
        </div>
    </header>

    <!-- Flash messages + page content -->
    <main class="cp-main">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="card" style="margin-bottom: 14px;">
                    {% for category, message in messages %}
                        <div class="small" style="margin-bottom: 4px;">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <footer class="cp-footer">
        <div>Â© {{ 2025 }} CryptoParcel. All rights reserved.</div>
        <div class="cp-footer-links">
            <a href="{{ url_for('index') }}">Home</a>
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('dashboard') }}">Dashboard</a>
            {% endif %}
        </div>
    </footer>
</div>

<!-- Simple JS: try click-to-open for the account menu -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    var menu = document.querySelector('.cp-user-menu');
    if (!menu) return;

    var trigger = menu.querySelector('.cp-user-trigger');
    var dropdown = menu.querySelector('.cp-user-dropdown');

    if (trigger) {
        trigger.addEventListener('click', function (e) {
            e.stopPropagation();
            menu.classList.toggle('is-open');
        });
    }

    // Close when clicking anywhere else
    document.addEventListener('click', function () {
        menu.classList.remove('is-open');
    });

    // Allow clicking inside dropdown without closing immediately
    if (dropdown) {
        dropdown.addEventListener('click', function (e) {
            e.stopPropagation();
        });
    }
});
</script>
</body>
</html>
