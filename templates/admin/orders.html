{% extends 'base.html' %}
{% block title %}Admin Orders â€” CryptoParcel{% endblock %}
{% block content %}
<section class="section">
  <h2>Orders</h2>
  <p>Filter:
    <a href="{{ url_for('admin_orders') }}">All</a> |
    <a href="{{ url_for('admin_orders', status='pending_payment') }}">Pending</a> |
    <a href="{{ url_for('admin_orders', status='paid') }}">Paid</a> |
    <a href="{{ url_for('admin_orders', status='cancelled') }}">Cancelled</a> |
    <a href="{{ url_for('admin_orders', status='cancelled_auto') }}">Auto-cancelled</a>
  </p>
  <table class="table">
    <tr>
      <th>ID</th><th>User</th><th>Status</th><th>Amount</th><th>Created</th><th>Actions</th>
    </tr>
    {% for o in orders %}
    <tr>
      <td>{{ o.id }}</td>
      <td>{{ o.user.email if o.user else 'n/a' }}</td>
      <td>{{ o.status }}</td>
      <td>${{ '%.2f'|format(o.amount_usd) }}</td>
      <td>{{ o.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
      <td>
        <form method="POST" action="{{ url_for('admin_cancel_order', order_id=o.id) }}" style="display:inline">
          <button class="btn small" type="submit">Cancel</button>
        </form>
        <form method="POST" action="{{ url_for('admin_delete_order', order_id=o.id) }}" style="display:inline" onsubmit="return confirm('Delete order {{ o.id }}?');">
          <button class="btn small danger" type="submit">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </table>
</section>
{% endblock %}
